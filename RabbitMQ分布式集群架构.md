为什么需要使用消息中间件，RabbitMQ?RabbitMQ的价值所在，优点在哪里？

1、解耦

可以大大减小系统之间的耦合度，这一点很符合微服务架构的思想，服务之间的解耦。

2、异步

使用消息中间件，达到异步调用的效果，大大减小系统响应的时间。这一点，可以解决因为时间，而导致的长时间不响应的问题。

项目中使用的场景：

定时任务，单独一个服务，该服务定时的去轮询订单是否达到了自动收货的时间，到达时间之后自动修改状态为已收货。。。

定时任务调用订单服务，为了尽快响应http状态，使用定时任务系统，达到异步的效果，不影响正常使用状态！

3、削峰

并发量大的时候，所有的请求直接怼到数据库，造成数据库连接异常，可以使用RabbitMQ做缓冲！减缓高并发带来的影响。

主要的消息中间件：

ActiveMQ,

RabbitMQ：中小型公司，erlang语言开发，开源社区活跃，实现了AMQP协议

RocketMQ：阿里产品，如果不维护很难受

Kafka：大型企业，稳定。日志采集功能



为什么选择RabbitMQ:

现在的市面上有很多MQ可以选择，比如ActiveMQ、ZeroMQ、Appche Qpid，那问题来了为什么要选择RabbitMQ？

**1.除了Qpid，RabbitMQ是唯一一个实现了AMQP标准的消息服务器；**

**2.可靠性，RabbitMQ的持久化支持，保证了消息的稳定性；**(缺点：持久化意味着磁盘I/O，会带来一定的性能影响)

**3.高并发，RabbitMQ使用了Erlang开发语言，Erlang是为电话交换机开发的语言，天生自带高并发光环，和高可用特性；**

**4.集群部署简单，正是应为Erlang使得RabbitMQ集群部署变的超级简单；**

**5.社区活跃度高，根据网上资料来看，RabbitMQ也是首选；**



MQ存在的问题以及解决方案：

1、消息的丢失问题，sender没有sender出去怎么办？怎么解决？

解决方案：AMQP的应答式消息反馈

2、消息的重复消费问题，即所谓的幂等性，如果一个消息被重复消费会出现什么问题，需要结合具体的业务来控制

解决方案

A、只要保持幂等性，不管来多少条重复消息，最后处理的结果都一样。第 2 条原理就是利用一张日志表来记录已经处理成功的消息的 ID，如果新到的消息 ID 已经在日志表中，那么就不再处理这条消息。

B、在业务中处理消息的重复性。

3、实现MQ的高可用性，多机多节点实现，分布式集群架构思路

# RabbitMQ分布式集群架构

https://blog.csdn.net/WoogeYu/article/details/51119101



多机部署，多节点的使用，注意问题：

1、保证需要部署的这几个节点在同一个局域网内

2、需要有相同的Erlang Cookie，否则不能进行通信，为保证cookie的完全一致，采用从一个节点copy的方式，下面就会使用这种方式



多机部署

多机多节点部署

1、单机模式

2、普通模式

3、镜像队列模式

